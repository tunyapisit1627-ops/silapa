@model IEnumerable<Silapa.Models.category>
@{
    ViewData["Title"] = "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà (Category)";
}

<div class="card">
    <div class="card-header">
        <h2 class="card-title">@ViewData["Title"]</h2>
        <div class="card-tools">
            <button type="button" class="btn btn-success btn-create"
                data-url="@Url.Action("CreateCategoryModal", "Admin")">
                <i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà
            </button>
        </div>
    </div>
    <div class="card-body">
        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>‡∏ä‡∏∑‡πà‡∏≠ (Name)</th>
                    <th>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡πá‡∏° (Fullname)</th>
                    <th style="width: 100px;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (Status)</th>
                    <th style="width: 150px;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@item.Name</td>
                        <td>@item.fullname</td>
                        <td class="text-center">
                            <form asp-action="ToggleCategoryStatus" asp-route-id="@item.Id" method="post"
                                style="display:inline;">
                                @Html.AntiForgeryToken()
                                @if (item.status == "1")
                                {
                                    <button type="submit" class="btn btn-xs btn-success" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î">
                                        <i class="fas fa-check-circle"></i> ‡πÄ‡∏õ‡∏¥‡∏î
                                    </button>
                                }
                                else
                                {
                                    <button type="submit" class="btn btn-xs btn-secondary" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î">
                                        <i class="fas fa-times-circle"></i> ‡∏õ‡∏¥‡∏î
                                    </button>
                                }
                            </form>
                        </td>
                        <td class="text-center">
                            <button type="button" class="btn btn-sm btn-warning btn-edit"
                                data-url="@Url.Action("EditCategoryModal", "Admin", new { id = item.Id })">
                                ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                            </button>
                            <form asp-action="DeleteCategory" asp-route-id="@item.Id" method="post" style="display:inline;"
                                class="form-delete ml-1">

                                @Html.AntiForgeryToken()

                                <button type="submit" class="btn btn-sm btn-danger" title="‡∏•‡∏ö">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<div class="modal fade" id="categoryModal" tabindex="-1" role="dialog" aria-labelledby="categoryModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content" id="modalContent">
        </div>
    </div>
</div>
@section Scripts {
    <script>
        $(function () {

            // 1. (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) ‡∏î‡∏±‡∏Å‡∏à‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° "‡∏™‡∏£‡πâ‡∏≤‡∏á" ‡πÅ‡∏•‡∏∞ "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç"
            $('.btn-create, .btn-edit').on('click', function () {
                var url = $(this).data('url');

                $('#modalContent').load(url, function () {
                    $('#categoryModal').modal('show');
                });
            });

            // 2. (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) ‡∏î‡∏±‡∏Å‡∏à‡∏±‡∏ö‡∏Å‡∏≤‡∏£ submit ‡∏ü‡∏≠‡∏£‡πå‡∏° AJAX
            // ‚ö°Ô∏è (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç) ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ID ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏õ‡πá‡∏ô #categoryForm
            $(document).on('submit', '#categoryForm', function (e) {
                e.preventDefault();
                var form = $(this);

                $.ajax({
                    url: form.attr('action'),
                    method: 'POST',
                    data: form.serialize(), // üëà ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ FormData ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå
                    success: function (response) {
                        if (response.success) {
                            $('#categoryModal').modal('hide');
                            location.reload(); // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤ List
                        } else {
                            // ‡∏ñ‡πâ‡∏≤ Validation ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô, Server ‡∏à‡∏∞‡∏™‡πà‡∏á HTML ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
                            $('#modalContent').html(response);
                        }
                    },
                    error: function () {
                        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ");
                    }
                });
            });
            $('.form-delete').on('submit', function (e) {
                var form = $(this);
                e.preventDefault(); // 1. ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£ Submit ‡∏õ‡∏Å‡∏ï‡∏¥

                // 2. ‡πÅ‡∏™‡∏î‡∏á SweetAlert ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
                Swal.fire({
                    title: '‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
                    text: "‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏° (‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ)",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: '‡πÉ‡∏ä‡πà, ‡∏•‡∏ö‡πÄ‡∏•‡∏¢!',
                    cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // 3. ‡∏ñ‡πâ‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô, ‡∏Ñ‡πà‡∏≠‡∏¢ Submit ‡∏ü‡∏≠‡∏£‡πå‡∏°
                        form.get(0).submit();
                    }
                });
            });

            // ----------------------------------------------------
            // ‚¨áÔ∏è 4. (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà) ‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• TempData (‡∏à‡∏≤‡∏Å Controller)
            // ----------------------------------------------------
            var msgTitle = '@TempData["MessageTitle"]';
            if (msgTitle) {
                Swal.fire({
                    title: msgTitle,
                    text: '@Html.Raw(TempData["MessageText"])', // (‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)
                    icon: '@TempData["MessageIcon"]'
                });
            }

        });
    </script>
}