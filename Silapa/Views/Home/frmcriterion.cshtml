@model IEnumerable<criterion>
@{
    ViewData["Title"] = "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô";
    int i = 1;
    int j = 1;
    // IList<Registerhead> models=ViewBag.data;
    System.Globalization.CultureInfo thaiCulture = new System.Globalization.CultureInfo("th-TH");
}
<div class="card">

    <div class="card-header">
        <h2 class="card-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</h2>
        @if (User.IsInRole("Admin"))
        {
            <div class="card-tools">
                <button type="button" class="btn btn-success btn-create"
                    data-url="@Url.Action("CreateCriterionModal", "Admin", new { settingId = ViewBag.ActiveSettingID, g_id = 1 })">
                    <i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏ì‡∏ë‡πå (Soft Power)
                </button>
                <button type="button" class="btn btn-primary btn-create"
                    data-url="@Url.Action("CreateCriterionModal", "Admin", new { settingId = ViewBag.ActiveSettingID, g_id = 2 })">
                    <i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏ì‡∏ë‡πå (‡∏à‡∏±‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°)
                </button>
            </div>
        }
    </div>
    <div class="card-body">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° Soft Power</h3>
            </div>
            <!-- /.card-header -->
            <div class="card-body p-0">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th style="width: 10px">#</th>
                            <th>‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö Soft Power</th>
                            <th style="width: 40px">‡πÑ‡∏ü‡∏•‡πå</th>
                            @if (User.IsInRole("Admin"))
                            {
                                <th style="width: 80px">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            }
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var dr in Model.Where(x => x.g_id == 1))
                        {
                            <tr>
                                <td>@i.</td>
                                <td>@dr.name</td>
                                <td><a href="~/pdf/@dr.file" target="_blank"><span
                                            class="badge bg-danger">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</span></a></td>
                                @if (User.IsInRole("Admin"))
                                {
                                    <td>
                                        <button type="button" class="btn btn-sm btn-warning btn-edit"
                                            data-url="@Url.Action("EditCriterionModal", "Admin", new { id = dr.id })">
                                            ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                        </button>
                                        <form asp-action="DeleteCriterion" asp-controller="Admin" asp-route-id="@dr.id" method="post"
                                            style="display:inline;" class="form-delete ml-1">

                                            @Html.AntiForgeryToken()

                                            <button type="submit" class="btn btn-sm btn-danger" title="‡∏•‡∏ö">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                    </td>
                                }
                            </tr>
                            i += 1;
                        }

                    </tbody>
                </table>
            </div>
            <!-- /.card-body -->
        </div>
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</h3>
            </div>
            <!-- /.card-header -->
            <div class="card-body p-0">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th style="width: 10px">#</th>
                            <th>‡∏Å‡∏•‡∏∏‡πà‡∏°/‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                            <th style="width: 40px">‡πÑ‡∏ü‡∏•‡πå</th>
                            @if (User.IsInRole("Admin"))
                            {
                                <th style="width: 80px">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            }
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var dr in Model.Where(x => x.g_id == 2))
                        {
                            <tr>
                                <td>@j.</td>
                                <td>@dr.name</td>
                                <td><a href="~/pdf/@dr.file" target="_blank"><span
                                            class="badge bg-danger">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</span></a></td>
                                @if (User.IsInRole("Admin"))
                                {
                                    <td>
                                        <button type="button" class="btn btn-sm btn-warning btn-edit"
                                            data-url="@Url.Action("EditCriterionModal", "Admin", new { id = dr.id })">
                                            ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                        </button>
                                        <form asp-action="DeleteCriterion" asp-controller="Admin" asp-route-id="@dr.id" method="post"
                                            style="display:inline;" class="form-delete ml-1">

                                            @Html.AntiForgeryToken()

                                            <button type="submit" class="btn btn-sm btn-danger" title="‡∏•‡∏ö">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                    </td>
                                }
                            </tr>
                            j += 1;
                        }

                    </tbody>
                </table>
            </div>
            <!-- /.card-body -->
        </div>
    </div>
</div>
@if (User.IsInRole("Admin"))
{
    <div class="modal fade" id="criterionModal" tabindex="-1" role="dialog" aria-labelledby="criterionModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content" id="modalContent">
            </div>
        </div>
    </div>
}
@section Scripts {
    <script>
        $(function () {
            // 1. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç" (class .btn-edit)
            $('.btn-edit, .btn-create').on('click', function () {
                var url = $(this).data('url');
                $('#modalContent').load(url, function () {
                    $('#criterionModal').modal('show');
                });
            });

            // 4. ‡∏î‡∏±‡∏Å‡∏à‡∏±‡∏ö‡∏Å‡∏≤‡∏£ submit ‡∏ü‡∏≠‡∏£‡πå‡∏° (id="editCriterionForm") ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Modal
            //    (‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ .on(..., '#editCriterionForm', ...) ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏°‡∏≤‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á)
            $(document).on('submit', '#editCriterionForm', function (e) {
                e.preventDefault(); // 5. ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£ submit ‡πÅ‡∏ö‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥

                var form = $(this);

                // 6. ‚ö°Ô∏è (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç) ‡πÉ‡∏ä‡πâ FormData ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå
                var formData = new FormData(form[0]);

                $.ajax({
                    url: form.attr('action'),
                    method: 'POST',
                    data: formData,
                    processData: false, // üëà (‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö FormData)
                    contentType: false, // üëà (‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö FormData)
                    success: function (response) {
                        if (response.success) {
                            // 7. ‡∏ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ‡∏õ‡∏¥‡∏î Modal ‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
                            $('#criterionModal').modal('hide');
                            location.reload();
                        } else {
                            // 8. ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (Validation fail): 
                            //    Server ‡∏à‡∏∞‡∏™‡πà‡∏á HTML ‡∏Ç‡∏≠‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏° (‡∏û‡∏£‡πâ‡∏≠‡∏° Error) ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
                            //    ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏¢‡∏±‡∏î HTML ‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô Modal
                            $('#modalContent').html(response);
                        }
                    },
                    error: function () {
                        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ");
                    }
                });
            });
            $('.form-delete').on('submit', function (e) {
                var form = $(this);
                e.preventDefault(); // 1. ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£ Submit ‡∏õ‡∏Å‡∏ï‡∏¥

                // 2. ‡πÅ‡∏™‡∏î‡∏á SweetAlert ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
                Swal.fire({
                    title: '‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
                    text: "‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏° (‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ)",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: '‡πÉ‡∏ä‡πà, ‡∏•‡∏ö‡πÄ‡∏•‡∏¢!',
                    cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // 3. ‡∏ñ‡πâ‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô, ‡∏Ñ‡πà‡∏≠‡∏¢ Submit ‡∏ü‡∏≠‡∏£‡πå‡∏°
                        form.get(0).submit();
                    }
                });
            });
            var msgTitle = '@TempData["MessageTitle"]';
            if (msgTitle) {
                Swal.fire({
                    title: msgTitle,
                    text: '@Html.Raw(TempData["MessageText"])',
                    icon: '@TempData["MessageIcon"]'
                });
            }
        });
    </script>
}