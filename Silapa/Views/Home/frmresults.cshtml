@{
    var setupsystem = ViewBag.setupsystem;
    ViewData["Title"] = $"{setupsystem.name} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà {setupsystem.time} ‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ {setupsystem.yaer} {setupsystem.ProvinceName}";
}

<style>
    /* --- CSS ‡∏´‡∏•‡∏±‡∏Å (Desktop) --- */

    /* ‡πÇ‡∏•‡πÇ‡∏Å‡πâ */
    .competition-logo {
        max-height: 120px;
        /* ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏•‡∏á‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á‡πÉ‡∏´‡πâ‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏ó‡∏µ‡πà */
        width: auto;
        display: block;
        margin: 0 auto;
        transition: transform 0.3s;
    }

    /* Container ‡∏Ç‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á (Desktop: ‡∏°‡∏µ Scrollbar) */
    .table-container {
        position: relative;
        height: 600px;
        overflow-y: auto;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        background: #fff;
    }

    /* ‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
    .table thead th {
        position: sticky;
        top: 0;
        background-color: #343a40;
        color: white;
        z-index: 10;
        text-align: center;
        border-top: none;
        white-space: nowrap;
    }

    /* ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• */
    .medal-badge {
        display: inline-flex;
        align-items: center;
        padding: 2px 8px;
        border-radius: 12px;
        font-weight: 500;
        font-size: 0.85rem;
        white-space: nowrap;
    }

    .medal-icon {
        width: 14px;
        height: 14px;
        margin-right: 4px;
    }

    /* --- üì± Mobile Optimization (‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç) --- */
    @@media (max-width: 768px) {

        /* 1. ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏Ñ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏¢‡∏≤‡∏ß‡πÑ‡∏î‡πâ */
        .table-container {
            height: auto !important;
            /* ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏¢‡∏≤‡∏ß‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• */
            overflow-y: visible !important;
            /* ‡∏õ‡∏¥‡∏î scrollbar ‡πÉ‡∏ô‡∏ï‡∏±‡∏ß */
            box-shadow: none;
            /* ‡∏•‡∏ö‡πÄ‡∏á‡∏≤‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÉ‡∏´‡∏ç‡πà */
            background: transparent;
        }

        /* 2. ‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏à‡∏±‡∏î Layout ‡πÉ‡∏´‡∏°‡πà) */
        .widget-26 thead {
            display: none;
        }

        /* 3. ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏ñ‡∏ß (tr) ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î */
        .widget-26 tbody tr {
            display: flex;
            flex-wrap: wrap;
            /* ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏´‡∏•‡∏•‡∏á‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ */
            background-color: #fff;
            margin-bottom: 10px;
            /* ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î */
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            /* ‡πÄ‡∏á‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πå‡∏î */
            border: 1px solid #e9ecef;
            padding: 10px;
            position: relative;
        }

        /* 4. ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ã‡∏•‡∏•‡πå (td) ‡πÉ‡∏´‡∏°‡πà */
        .widget-26 td {
            border: none !important;
            padding: 2px 5px !important;
            display: block;
        }

        /* --- ‡∏à‡∏±‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î --- */

        /* [1] ‡∏•‡∏≥‡∏î‡∏±‡∏ö/‡∏£‡∏∞‡∏î‡∏±‡∏ö (‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô) */
        .widget-26 td:nth-child(1) {
            width: 100%;
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 2px;
            text-align: left !important;
        }

        .widget-26 td:nth-child(1)::before {
            content: "‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà ";
            /* ‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤ */
        }

        /* [2] ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡πÄ‡∏î‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î) */
        .widget-26 td:nth-child(2) {
            width: 100%;
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 8px;
            text-align: left !important;
            border-bottom: 1px dashed #eee !important;
            padding-bottom: 8px !important;
        }

        /* [3] ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡∏ã‡πâ‡∏≤‡∏¢‡∏•‡πà‡∏≤‡∏á) */
        .widget-26 td:nth-child(3) {
            width: 30%;
            /* ‡∏Å‡∏¥‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà 30% */
            text-align: left !important;
            font-size: 0.9rem;
            color: #555;
        }

        .widget-26 td:nth-child(3)::before {
            content: "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ";
            font-weight: bold;
        }

        /* [4] ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• (‡∏Å‡∏•‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á) */
        .widget-26 td:nth-child(4) {
            width: 40%;
            text-align: left !important;
        }

        /* [5] ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞/‡∏ä‡∏ô‡∏∞‡πÄ‡∏•‡∏¥‡∏® (‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á) */
        .widget-26 td:nth-child(5) {
            width: 30%;
            text-align: right !important;
        }

        /* ‡∏õ‡∏£‡∏±‡∏ö Dropdown ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ */
        .filter-col {
            margin-bottom: 10px;
        }
    }
</style>

<div class="container py-4">
    <div class="row justify-content-center mb-4">
        <div class="col-lg-8 text-center">
            <img src="@Url.Content(setupsystem.LogoPath)" class="competition-logo mb-3" alt="Logo">
            <div class="section-title">
                <h4 class="title font-weight-bold">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</h4>
                <h5 class="text-muted">@setupsystem.name</h5>
                <p class="text-muted small">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà @setupsystem.time ‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ @setupsystem.yaer
                    @setupsystem.ProvinceName</p>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <form id="search-form">
                        <div class="row align-items-center">
                            <div class="col-md-4 filter-col">
                                <label class="small text-muted mb-1">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞/‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                                @Html.DropDownList("c_id", (IEnumerable<SelectListItem>)ViewBag.levelData, "--- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ---", new { @class = "form-control select2", @style = "width: 100%;" })
                            </div>
                            <div class="col-md-8 filter-col">
                                <label class="small text-muted mb-1">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</label>
                                <select class="form-control select2" id="exampleFormControlSelect2" disabled>
                                    <option value="">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏Å‡πà‡∏≠‡∏ô</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm border-0">
                <div class="card-body p-0">
                    <div class="table-container table-responsive">
                        <table class="table widget-26 mb-0">
                            <thead>
                                <tr>
                                    <th scope="col" style="width: 10%;">‡∏£‡∏∞‡∏î‡∏±‡∏ö</th>
                                    <th scope="col" style="width: 40%; text-align: left;">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                                    <th scope="col" style="width: 15%;">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>
                                    <th scope="col" style="width: 20%;">‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</th>
                                    <th scope="col" style="width: 15%;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                </tr>
                            </thead>
                            <tbody id="resultsTableBody">
                                <tr>
                                    <td colspan="5" class="text-center py-5 text-muted">
                                        <i class="fas fa-search fa-3x mb-3"></i><br>
                                        ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ú‡∏•
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="schoolModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header bg-light">
                <h5 class="modal-title"><i class="fas fa-school mr-2"></i>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div id="fireworks-container"
                style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10;">
            </div>

            <div class="modal-body">
                <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">‡∏õ‡∏¥‡∏î</button>
                <button type="button" class="btn btn-success shadow" id="printCertificate" onclick="downloadPdf()"
                    disabled>
                    <i class="fas fa-print mr-1"></i> ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£
                </button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/fireworks-js@latest/dist/fireworks.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />

    <script>
        $(function () {
            // Init Select2
            $('.select2').select2({
                theme: 'bootstrap4',
                width: '100%'
            });

            // 1. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà (Load ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô)
            $("#c_id").change(function () {
                const selectedValue = $(this).val();
                const $targetSelect = $("#exampleFormControlSelect2");

                if (selectedValue) {
                    $targetSelect.prop("disabled", true).html('<option>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</option>'); // Show loading state

                    $.ajax({
                        url: '/Home/GetCompetitionsresult',
                        type: 'GET',
                        data: { c_id: selectedValue },
                        success: function (data) {
                            $targetSelect.empty().append('<option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô --</option>');

                            if (!data || data.length === 0) {
                                Swal.fire({
                                    icon: 'info',
                                    title: '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ú‡∏•',
                                    text: '‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ú‡∏•',
                                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                                });
                            } else {
                                data.forEach(item => {
                                    $targetSelect.append(`<option value="${item.id}">${item.name}</option>`);
                                });
                            }
                        },
                        error: function () {
                            Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÑ‡∏î‡πâ', 'error');
                        },
                        complete: function () {
                            $targetSelect.prop("disabled", false);
                        }
                    });
                } else {
                    $targetSelect.empty().append('<option value="">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏Å‡πà‡∏≠‡∏ô</option>').prop("disabled", true);
                    $("#resultsTableBody").html('<tr><td colspan="5" class="text-center py-5 text-muted">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</td></tr>');
                }
            });

            // 2. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô (Load ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô)
            $("#exampleFormControlSelect2").change(function () {
                const selectedValue = $(this).val();
                const $tableBody = $("#resultsTableBody");

                if (selectedValue) {
                    $tableBody.html('<tr><td colspan="5" class="text-center py-5"><div class="spinner-border text-primary"></div><br>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô...</td></tr>');

                    $.ajax({
                        url: '/Home/GetResults',
                        type: 'GET',
                        data: { competitionId: selectedValue },
                        success: function (data) {
                            $tableBody.empty();

                            if (data.length === 0) {
                                $tableBody.html('<tr><td colspan="5" class="text-center py-3">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ</td></tr>');
                                return;
                            }

                            data.forEach((item) => {
                                const medalStyle = getMedalStyle(item.notes);

                                // Logic ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                                let statusText = "";
                                if (item.level === 1) statusText = '<span class="badge badge-warning text-white">üèÜ ‡∏ä‡∏ô‡∏∞‡πÄ‡∏•‡∏¥‡∏®</span>';
                                else if (item.level === 2) statusText = '<span class="badge badge-secondary">ü•à ‡∏£‡∏≠‡∏á‡∏Ø 1</span>';
                                else if (item.level === 3) statusText = '<span class="badge badge-danger">ü•â ‡∏£‡∏≠‡∏á‡∏Ø 2</span>';
                                else if (item.level >= 4 && item.level <= 10) statusText = `<span class="badge badge-info">‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà ${item.level}</span>`;
                                else statusText = '-';

                                const row = `
                                        <tr>
                                            <td class="text-center font-weight-bold">${item.level}</td>
                                            <td>
                                                <a href="#" class="school-link text-primary font-weight-bold" data-id="${item.id}">
                                                    <i class="fas fa-university mr-1"></i> ${item.school}
                                                </a>
                                            </td>
                                            <td class="text-center">${item.score}</td>
                                            <td class="text-center">
                                                ${medalStyle}
                                            </td>
                                            <td class="text-center">${statusText}</td>
                                        </tr>
                                    `;
                                $tableBody.append(row);
                            });
                        },
                        error: function () {
                            $tableBody.html('<tr><td colspan="5" class="text-center text-danger">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>');
                        }
                    });
                } else {
                    $tableBody.empty();
                }
            });

            // 3. Modal ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
            $(document).on('click', '.school-link', function (e) {
                e.preventDefault();
                var id = $(this).data('id');

                $('#schoolModal .modal-body').html('<div class="text-center py-5"><div class="spinner-border"></div></div>');
                $('#schoolModal').modal('show');

                $.ajax({
                    url: '/Home/GetSchoolDetailsresult',
                    method: 'GET',
                    data: { id: id },
                    success: function (data) {
                        $('#schoolModal .modal-body').html(data);
                        // Trigger fireworks if rank is 1 (Optional logic)
                        // startFireworks(); 
                    },
                    error: function () {
                        $('#schoolModal .modal-body').html('<div class="alert alert-danger">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</div>');
                    }
                });
            });

            // Helper function for medal styles
            function getMedalStyle(medalName) {
                if (!medalName) return '-';

                let color = '#6c757d'; // Default gray
                let icon = 'fa-medal';

                if (medalName.includes("‡∏ó‡∏≠‡∏á")) color = '#FFD700'; // Gold
                else if (medalName.includes("‡πÄ‡∏á‡∏¥‡∏ô")) color = '#C0C0C0'; // Silver
                else if (medalName.includes("‡∏ó‡∏≠‡∏á‡πÅ‡∏î‡∏á")) color = '#CD7F32'; // Bronze

                if (color !== '#6c757d') {
                    return `<span class="medal-badge" style="background-color: ${color}; color: #fff; text-shadow: 1px 1px 2px black;">
                                    <i class="fas ${icon} medal-icon"></i> ${medalName}
                                </span>`;
                }
                return medalName;
            }

            // Logic ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£
            checkCertificateAvailability();
        });

        async function checkCertificateAvailability() {
            const printButton = document.getElementById("printCertificate");
            if (!printButton) return;

            try {
                const response = await fetch('/Home/GetCertificateDate');
                if (!response.ok) throw new Error("Network error");

                const data = await response.json();
                const [day, month, yearBE] = data.certificatedate.split("/");
                const yearCE = parseInt(yearBE, 10) - 543;
                const certificatedate = new Date(`${yearCE}-${month}-${day}`);
                const now = new Date();

                if (now >= certificatedate) {
                    printButton.disabled = false;
                } else {
                    // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤ ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏Å‡πà‡∏≠‡∏ô (‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡∏Å‡πá‡πÑ‡∏î‡πâ)
                    printButton.title = `‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${data.certificatedate}`;
                }
            } catch (err) {
                console.error("Error checking certificate date:", err);
            }
        }

        function downloadPdf() {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ h_id ‡πÉ‡∏ô Modal ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤ partial view ‡∏°‡∏µ hidden field ‡∏ô‡∏µ‡πâ)
            var h_id = document.getElementById("h_id") ? document.getElementById("h_id").value : null;
            var settingId = document.getElementById("settingId") ? document.getElementById("settingId").value : null;

            if (h_id && settingId) {
                var url = '@Url.Action("GenePdfCertificate1", "Pdfmember")' + '?settingId=' + settingId + '&h_id=' + h_id + '&type=1';
                window.location.href = url;
            } else {
                Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£', 'warning');
            }
        }
    </script>
}