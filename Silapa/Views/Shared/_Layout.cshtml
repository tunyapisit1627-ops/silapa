@using Microsoft.AspNetCore.Identity
@inject Microsoft.Extensions.Configuration.IConfiguration Configuration
@using System.Security.Claims
@inject UserManager<ApplicationUser> UserManager
@inject ApplicationDbContext _db_layout
@{
    var user = await UserManager.GetUserAsync(User);
    var newsList = ViewBag.news as List<news>;
    var lineID = "@668ptodu";
    bool enableMourning = Configuration.GetValue<bool>("ThemeSettings:EnableMourningTheme");
    var activeSystem = _db_layout.setupsystem.FirstOrDefault(s => s.status == "1");

    // กำหนด path ของโลโก้
    var logoPath = (activeSystem != null && !string.IsNullOrEmpty(activeSystem.LogoPath))
    ? activeSystem.LogoPath // ถ้ามีใน DB ให้ใช้ path นั้น
    : "~/img/logo.png"; // ถ้าไม่มีใน DB (หรือยังไม่ตั้งค่า) ให้ใช้ path สำรอง

    bool showUrgentBanner = false;
    int daysLeft = 0;
    bool isRacePeriod = false;

    // ตรวจสอบว่ามีข้อมูลและวันที่สิ้นสุดไม่เป็นค่าว่าง
    if (activeSystem != null && !string.IsNullOrEmpty(activeSystem.endgisterdate))
    {
        try
        {
            // 2. แปลงวันที่จาก String (พ.ศ.) เป็น DateTime (ค.ศ.)
            // สมมติ format คือ "dd/MM/yyyy" เช่น "08/11/2568"
            var parts = activeSystem.endgisterdate.Split('/');

            if (parts.Length == 3)
            {
                int day = int.Parse(parts[0]);
                int month = int.Parse(parts[1]);
                int yearBE = int.Parse(parts[2]);
                int yearAD = yearBE - 543; // ลบ 543 เพื่อแปลงเป็น ค.ศ.

                DateTime endDate = new DateTime(yearAD, month, day); // เวลาจะเป็น 00:00:00

                // เพื่อความแม่นยำ ให้ตั้งเวลาจบเป็นสิ้นวัน (23:59:59)
                endDate = endDate.Date.AddDays(-1).AddTicks(-1);

                DateTime today = DateTime.Now;

                // 3. คำนวณหาจำนวนวันที่เหลือ
                TimeSpan difference = endDate - today;
                daysLeft = (int)Math.Ceiling(difference.TotalDays); // ปัดเศษขึ้น เช่น 2.5 วัน คือเหลือ 3 วัน

                // 4. เช็คเงื่อนไข: เหลือ 0 ถึง 3 วัน
                if (daysLeft >= 0 && daysLeft <= 3)
                {
                    showUrgentBanner = true;
                }
            }
        }
        catch
        {
            // กรณีวันที่ในฐานข้อมูลผิด Format ไม่ต้องแสดงแบนเนอร์
            showUrgentBanner = false;
        }
    }
    if (activeSystem != null && !string.IsNullOrEmpty(activeSystem.racedate))
    {
        try
        {
            // แยกวันที่ (รองรับทั้ง " - " และ "-")
            var parts = activeSystem.racedate.Split(new string[] { " - ", "-" }, StringSplitOptions.RemoveEmptyEntries);

            // Format วันที่ใน DB ของคุณ (MM/dd/yyyy ตามที่คุยกันก่อนหน้า)
            string[] formats = { "MM/dd/yyyy", "dd/MM/yyyy" };
            var provider = System.Globalization.CultureInfo.InvariantCulture;

            if (DateTime.TryParseExact(parts[0].Trim(), formats, provider, System.Globalization.DateTimeStyles.None, out DateTime
            startDate))
            {
                DateTime endDate = startDate; // ถ้ามีวันเดียว ให้จบวันเดียวกัน

                if (parts.Length > 1)
                {
                    DateTime.TryParseExact(parts[1].Trim(), formats, provider, System.Globalization.DateTimeStyles.None, out endDate);
                }

                // ⚡️ เช็คว่า "วันนี้" อยู่ในช่วงวันแข่ง หรือ "ผ่านไปแล้ว" (แสดงผลตลอดหลังแข่ง)
                // หรือถ้าเอาแค่ "ระหว่างแข่ง" ให้ใช้: (DateTime.Now.Date >= startDate.Date && DateTime.Now.Date <= endDate.Date)
                if (DateTime.Now.Date >= startDate.Date)
                {
                    isRacePeriod = true;
                }
            }
        }
        catch { /* เงียบไว้ถ้าแกะวันที่ไม่ออก */ }
    }
}
@functions {
    private string FormatThaiDateRange(string dateRangeString)
    {
        if (string.IsNullOrEmpty(dateRangeString))
        {
            return "(ยังไม่กำหนด)";
        }

        try
        {
            var parts = dateRangeString.Split(" - ");
            if (parts.Length != 2)
            {
                return dateRangeString;
            }

            // ----------------------------------------------------
            // ⬇️ จุดที่แก้ไข: เปลี่ยน "dd/MM/yyyy" เป็น "MM/dd/yyyy"
            // ----------------------------------------------------
            string parseFormat = "MM/dd/yyyy";
            var provider = System.Globalization.CultureInfo.InvariantCulture;

            DateTime startDate = DateTime.ParseExact(parts[0], parseFormat, provider);
            DateTime endDate = DateTime.ParseExact(parts[1], parseFormat, provider);

            var thaiCulture = new System.Globalization.CultureInfo("th-TH");

            if (startDate.Month == endDate.Month && startDate.Year == endDate.Year)
            {
                // ผลลัพธ์: 12-14 ธันวาคม 2567 (ถ้าข้อมูลเป็นปี 2024)
                return $"{startDate.Day}-{endDate.Day} {endDate.ToString("MMMM yyyy", thaiCulture)}";
            }
            else if (startDate.Year == endDate.Year)
            {
                return $"{startDate.ToString("d MMM", thaiCulture)} - {endDate.ToString("d MMM yyyy", thaiCulture)}";
            }
            else
            {
                return $"{startDate.ToString("d MMM yyyy", thaiCulture)} - {endDate.ToString("d MMM yyyy", thaiCulture)}";
            }
        }
        catch (Exception)
        {
            // ถ้า Error, คืนค่าเดิม
            return dateRangeString;
        }
    }
}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="-1" />
    <title>@ViewData["Title"] - Silapa</title>
    <!-- Google Font: Source Sans Pro -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/Silapa.styles.css" asp-append-version="true" />
    <!-- Syncfusion ASP.NET MVC controls styles -->
    <link rel="stylesheet" href="https://cdn.syncfusion.com/ej2/26.2.4/fluent.css" />
    <!-- Syncfusion ASP.NET MVC controls scripts -->
    <script src="https://cdn.syncfusion.com/ej2/26.2.4/dist/ej2.min.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="~/plugins/fontawesome-free/css/all.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <!-- Tempusdominus Bootstrap 4 -->
    <link rel="stylesheet" href="~/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css">
    <!-- iCheck -->
    <link rel="stylesheet" href="~/plugins/icheck-bootstrap/icheck-bootstrap.min.css">
    <!-- JQVMap -->
    <link rel="stylesheet" href="~/plugins/jqvmap/jqvmap.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="~/css/adminlte.min.css">
    <!-- overlayScrollbars -->
    <link rel="stylesheet" href="~/plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
    <!-- Daterange picker -->
    <link rel="stylesheet" href="~/plugins/daterangepicker/daterangepicker.css">
    <!-- summernote -->
    <link rel="stylesheet" href="~/plugins/summernote/summernote-bs4.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" />
    <!-- jsGrid -->
    <link rel="stylesheet" href="~/plugins/jsgrid/jsgrid.min.css">
    <link rel="stylesheet" href="~/plugins/jsgrid/jsgrid-theme.min.css">
    <!-- DataTables -->
    <link rel="stylesheet" href="~/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="~/plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
    <link rel="stylesheet" href="~/plugins/datatables-buttons/css/buttons.bootstrap4.min.css">
    <!-- daterange picker -->
    <link rel="stylesheet" href="~/plugins/daterangepicker/daterangepicker.css">
    <!-- iCheck for checkboxes and radio inputs -->
    <link rel="stylesheet" href="~/plugins/icheck-bootstrap/icheck-bootstrap.min.css">
    <!-- Bootstrap Color Picker -->
    <link rel="stylesheet" href="~/plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css">
    <!-- Tempusdominus Bootstrap 4 -->
    <link rel="stylesheet" href="~/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css">
    <!-- Select2 -->
    <link rel="stylesheet" href="~/plugins/select2/css/select2.min.css">
    <link rel="stylesheet" href="~/plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css">
    <!-- Bootstrap4 Duallistbox -->
    <link rel="stylesheet" href="~/plugins/bootstrap4-duallistbox/bootstrap-duallistbox.min.css">
    <!-- BS Stepper -->
    <link rel="stylesheet" href="~/plugins/bs-stepper/css/bs-stepper.min.css">
    <!-- dropzonejs -->
    <link rel="stylesheet" href="~/plugins/dropzone/min/dropzone.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="~/dist/css/adminlte.min.css">
    <!-- summernote -->
    <link rel="stylesheet" href="~/plugins/summernote/summernote-bs4.min.css">
    <!-- CodeMirror -->
    <link rel="stylesheet" href="~/plugins/codemirror/codemirror.css">
    <link rel="stylesheet" href="~/plugins/codemirror/theme/monokai.css">
    <!-- FontGoogle -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Sarabun:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

    @if (enableMourning)
    {
        <link rel="stylesheet" href="~/css/mourning.css" asp-append-version="true" />
    }
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            scroll-behavior: smooth !important;
            font-family: 'Sarabun', sans-serif;
            overflow-x: hidden;

        }
    </style>
</head>

<body class="hold-transition sidebar-collapse layout-top-nav">
    <div class="wrapper">
        <nav class="main-header navbar navbar-expand-md navbar-light navbar-white">
            <div class="container-fluid">
                <a asp-action="Index" asp-controller="Home" class="navbar-brand">
                    <img src="@Url.Content(logoPath)" alt="Silapa" class="brand-image img-circle elevation-3"
                        style="opacity: .8">
                    <span class="brand-text font-weight-light">Silapa</span>
                </a>

                <button class="navbar-toggler order-1" type="button" data-toggle="collapse"
                    data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <!-- Left navbar links -->
                @await Html.PartialAsync("_Menu", User)
        </nav>

        @if (ViewBag.ShowParallax ?? false)
        {
            <section class="hero">

                <div class="hero-content">
                    @if (showUrgentBanner)
                    {
                        <div class="urgent-banner">
                            <span class="icon">🚨</span>
                            <span class="text">
                                @if (daysLeft == 0)
                                {
                                    <text>ด่วน! วันนี้วันสุดท้ายของการรับสมัคร!</text>
                                }
                                else
                                {
                                    <text>เหลือเวลาสมัครเพียง @daysLeft วันสุดท้ายเท่านั้น!</text>
                                }
                            </span>
                            <a href="/Account/Login" class="banner-cta">สมัครทันที!</a>
                        </div>
                    }
                    <div class="animated-logo">
                        <img src="@Url.Content(logoPath)" alt="งานศิลปหัตถกรรมนักเรียน Logo" class="logo-svg">
                    </div>
                    <h2>@activeSystem.name</h2>
                    <h2>@activeSystem.ProvinceName ครั้งที่ @activeSystem.time ปีการศึกษา @activeSystem.yaer</h2>

                    <p class="subtitle">
                        ระหว่างวันที่ @FormatThaiDateRange(activeSystem.racedate) @activeSystem.nameagency
                        <br />
                        "@activeSystem.SloganThai"
                        <br />
                        "@activeSystem.SloganEnglish"
                    </p>
                    <div class="cta-buttons">

                        @* --------------------------------------------------------- *@
                        @* ⬇️ กรณีที่ 1: ถึงวันแข่งแล้ว (เอาปุ่มผลการแข่งขันขึ้นก่อน) ⬇️ *@
                        @* --------------------------------------------------------- *@
                        @if (isRacePeriod)
                        {
                            <a href="#" class="cta-button" id="HeroResultsButton"
                                style="background-color: #FFD700; color: #000; border: none; font-weight: bold; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);">
                                🏆 ดูผลการแข่งขัน
                            </a>

                            <a href="#schedule" class="cta-button secondary" id="ContestScheduleButton">📋 ตารางแข่ง</a>
                            <a href="#services1" class="cta-button secondary" id="announcementButton">ประกาศ</a>
                            <a href="#" class="cta-button secondary" id="criteriaButton">เกณฑ์</a>
                            <a href="#" class="cta-button secondary" id="FilelistButton">📂 เอกสาร</a>
                        }

                        @* --------------------------------------------------------- *@
                        @* ⬇️ กรณีที่ 2: ยังไม่ถึงวันแข่ง (เรียงแบบเดิม) ⬇️ *@
                        @* --------------------------------------------------------- *@
                        else
                        {
                            <a href="#services1" class="cta-button" id="announcementButton">ประกาศ</a>
                            <a href="#" class="cta-button secondary" id="criteriaButton">เกณฑ์</a>
                            <a href="#" class="cta-button secondary" id="FilelistButton">📂 คำสั่ง/เอกสาร</a>
                            <a href="#news-section" class="cta-button secondary" id="newsAnchorButton">📰 ข่าว</a>
                            <a href="#schedule" class="cta-button secondary" id="ContestScheduleButton">📋 ตารางแข่ง</a>

                        }

                    </div>
                </div>
                <div class="scroll-indicator">
                    <div style="font-size: 2rem;">↓</div>
                    <div>เลื่อนลงเพื่อดูเพิ่มเติม</div>
                </div>
            </section>
            <section class="about reveal"
                style="position: relative; overflow: hidden; min-height: 100vh; display: flex; align-items: center; justify-content: center;">
                <video autoplay muted loop playsinline class="video-background"
                    poster="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1920 1080'%3E%3Crect fill='%23f093fb' width='1920' height='1080'/%3E%3C/svg%3E"
                    style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1;">
                    <source src="@Url.Content(activeSystem.HeroVideoPath ?? "~/vdo/vdo.mp4")" type="video/mp4">
                </video>

                <div
                    style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 2;">
                </div>

                <div class="about-content"
                    style="position: relative; z-index: 3; max-width: 800px; text-align: center; color: white; padding: 20px;">

                    <h2
                        style="font-size: 2.5em; color: #fff; text-shadow: 0px 0px 8px rgba(0,0,0,0.8); margin-bottom: 10px;">
                        @activeSystem.AboutHeading
                    </h2>

                    <p style="font-size: 1.2em; color: #fff; text-shadow: 1px 1px 3px rgba(0,0,0,0.7);">
                        @activeSystem.AboutText1
                    </p>
                    <p style="font-size: 1.2em; color: #fff; text-shadow: 1px 1px 3px rgba(0,0,0,0.7);">
                        @activeSystem.AboutText2
                    </p>
                </div>
            </section>
            <!-- Team Section -->
            <section class="team reveal team-section" style="background-image: url('images/team-photo1.png');">
                <div class="overlay"
                    style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);">
                </div>
                <div style="position: relative; z-index: 2; text-align: center; padding-bottom: 50px;">
                    <h2
                        style="font-size: 2.5em; color: #fff; text-shadow: 2px 2px 4px rgba(0,0,0,0.7); margin-bottom: 10px;">
                        ทีมผู้สร้างสรรค์และคุณครูผู้เชี่ยวชาญ</h2>
                    <div class="team-description" style="max-width: 800px; margin: 0 auto 30px auto;">
                        <p style="font-size: 1.1em; color: #fff; text-shadow: 1px 1px 2px rgba(0,0,0,0.7);">
                            คุณครูและนักเรียนของเราคือหัวใจสำคัญของงานศิลปหัตถกรรมครั้งที่ 73
                            ด้วยความทุ่มเท พรสวรรค์ และความรู้ความสามารถจากทุกกลุ่มสาระการเรียนรู้</p>
                    </div>
                    <div class="team-categories"
                        style="display: flex; flex-wrap: wrap; justify-content: center; gap: 20px;">
                        <a asp-action="frmrefereeAll" asp-controller="Home" style="text-decoration: none;">
                            <div class="team-category"
                                style="background-color: rgba(255,255,255,0.9); padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                                <h3 style="color: #0056b3; font-size: 1.5em; margin-bottom: 10px;">🏆 คณะกรรมการดำเนินงาน
                                </h3>
                                <p style="color: #333; font-size: 0.95em;">
                                    ผู้บริหารสถานศึกษาและคณะครูผู้รับผิดชอบหลักในการจัดงาน</p>
                            </div>
                        </a>
                        <a asp-action="frmrefereeAll" asp-controller="Home" style="text-decoration: none;">
                            <div class="team-category"
                                style="background-color: rgba(255,255,255,0.9); padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); ">
                                <h3 style="color: #0056b3; font-size: 1.5em; margin-bottom: 10px;">🥇 ทีมตัดสินและประเมินผล
                                </h3>
                                <p style="color: #333; font-size: 0.95em;">ผู้ทรงคุณวุฒิและครูผู้เชี่ยวชาญในสาขาต่างๆ
                                    ที่ดูแลการตัดสินอย่างยุติธรรม</p>
                            </div>
                        </a>
                        <div class="team-category"
                            style="background-color: rgba(255,255,255,0.9); padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <h3 style="color: #0056b3; font-size: 1.5em; margin-bottom: 10px;">✨ เยาวชนนักสร้างสรรค์
                            </h3>
                            <p style="color: #333; font-size: 0.95em;">นักเรียนผู้เข้าแข่งขันทุกคน
                                ที่เป็นตัวแทนของความสามารถและพรสวรรค์</p>
                        </div>

                    </div>
                </div>
            </section>
            <section class="partners reveal" style="padding: 60px 20px; background-color: #ffffff; text-align: center;">

                <h2 style="font-size: 2.5em; color: #333; margin-bottom: 40px;">
                    หน่วยงานที่เข้าร่วม
                </h2>

                <div style="max-width: 1200px; margin: 0 auto; padding: 0 15px;">

                    <img src="@Url.Content("~/images/partners/banner-partners.png")"
                        alt="แบนเนอร์แสดงหน่วยงานที่เข้าร่วมงานศิลปหัตถกรรม"
                        style="width: 100%; 
                                                                                            height: auto; 
                                                                                            border-radius: 12px; 
                                                                                            box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                </div>

            </section>
            <!-- Services Section -->
            <section class="services reveal" id="services">
                <h2>การแข่งขันครอบคลุมทุกกลุ่มสาระการเรียนรู้</h2>
                <div class="services-grid">
                    <div class="service-card">
                        <div class="service-icon" style="font-size: 2em;">🔬➕💻</div>
                        <h3>กลุ่มทักษะวิชาการ, นวัตกรรมและเทคโนโลยี</h3>
                        <p>เวทีสำหรับผู้มีความสามารถในการคิดวิเคราะห์ การคำนวณ และสร้างสรรค์นวัตกรรม</p>
                        <ul>
                            <li>**คณิตศาสตร์:** ทักษะการคิดคำนวณ, โครงงานคณิตศาสตร์</li>
                            <li>**วิทยาศาสตร์:** โครงงานวิทยาศาสตร์, สิ่งประดิษฐ์เชิงนวัตกรรม</li>
                            <li>**เทคโนโลยี:** การสร้างแอปพลิเคชัน, โปรแกรม, และสื่อดิจิทัล</li>
                        </ul>
                    </div>
                    <div class="service-card">
                        <div class="service-icon" style="font-size: 2em;">📚🗣️🌍</div>
                        <h3>กลุ่มทักษะภาษาและการสื่อสาร</h3>
                        <p>ส่งเสริมทักษะการใช้ภาษา การเขียนเชิงสร้างสรรค์ และการนำเสนอที่หลากหลาย</p>
                        <ul>
                            <li>**ภาษาไทย:** การแต่งกลอน, เขียนเรียงความ, ทักษะการสื่อสารเชิงสร้างสรรค์</li>
                            <li>**ภาษาต่างประเทศ:** การแสดงบทบาทสมมติ, การเล่าเรื่อง, การนำเสนอสองภาษา</li>
                            <li>**สังคมศึกษาฯ:** โครงงานคุณธรรม, การนำเสนอวัฒนธรรมและประเพณี</li>
                        </ul>
                    </div>
                    <div class="service-card">
                        <div class="service-icon" style="font-size: 2em;">🎨🎭🎉</div>
                        <h3>กลุ่มทักษะศิลปะ, หัตถกรรมและพัฒนาผู้เรียน</h3>
                        <p>แสดงความสามารถด้านสุนทรียะ งานฝีมือ และการแสดงออกทางศิลปวัฒนธรรม</p>
                        <ul>
                            <li>**ศิลปะ/ดนตรี/นาฏศิลป์:** วาดภาพ, ปั้น, ร้องเพลง, บรรเลงเครื่องดนตรี</li>
                            <li>**การงานอาชีพ:** งานประดิษฐ์จากวัสดุเหลือใช้, อาหารและโภชนาการ</li>
                            <li>**กิจกรรมพัฒนาผู้เรียน:** กิจกรรมลูกเสือ-เนตรนารี, ชุมนุมและบำเพ็ญประโยชน์</li>
                        </ul>
                    </div>
                </div>
            </section>
            <section class="stats reveal">
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-number">@ViewBag.datalist</span>
                        <div class="stat-label">รายการแข่งขันทั้งหมด</div>
                    </div>

                    <div class="stat-item">
                        <span class="stat-number">@ViewBag.datacounts</span>
                        <div class="stat-label">นักเรียนเข้าร่วม</div>
                    </div>

                    <div class="stat-item">
                        <span class="stat-number">@ViewBag.datacountt</span>
                        <div class="stat-label">ครูผู้ฝึกซ้อม</div>
                    </div>

                    <div class="stat-item">
                        <span class="stat-number">@ViewBag.refess</span>
                        <div class="stat-label">คณะกรรมการตัดสิน</div>
                    </div>
                </div>
            </section>
            <section class="containerlayout">
                <div class="s-timeline">
                    @{
                        // 🚨 แคสต์ ViewBag.TimelineItems เป็น List<TimelineItem>
                        var timelineItems = ViewBag.TimelineItems as List<TimelineItem>;
                    }

                    @if (timelineItems != null)
                    {
                        @foreach (var item in timelineItems)
                        {
                            <div class="s-timeline-item">
                                <div class="s-timeline-content">
                                    <div class="s-timeline-date">@item.DateRange</div>
                                    <h3 class="s-timeline-title">@item.Title</h3>
                                    <p class="s-timeline-desc">@item.Description</p>

                                    <span class="status-badge @item.StatusClass">@item.StatusText</span>
                                </div>
                                <div class="s-timeline-icon">@item.IconNumber</div>
                            </div>
                        }
                    }
                </div>
            </section>
            <section class="containerlayout" id="news-section">
                <div class="section-title">
                    <h2>📰 ข่าวประชาสัมพันธ์</h2>
                    <p>ติดตามข่าวสารและกิจกรรมที่น่าสนใจของงานศิลปหัตถกรรม</p>
                </div>

                <div class="news-grid">
                    @if (newsList != null && newsList.Any())
                    {
                        // วนซ้ำข้อมูลข่าวทั้งหมด
                        @foreach (var item in newsList)
                        {
                            // กำหนดให้ข่าวแรกเป็น Featured (ถ้ามี)
                            bool isFeatured = item.id == newsList.FirstOrDefault()?.id;

                            <div class="news-card @(isFeatured ? "featured" : "")">

                                @* 🚨 Badge: ใช้ BadgeText และ BadgeClass (เช่น bg-danger) *@
                                @if (!string.IsNullOrEmpty(item.BadgeText))
                                {
                                    // ใช้ BadgeClass ที่บันทึกจากฟอร์ม เช่น "bg-danger"
                                    <div class="news-badge @item.BadgeClass">
                                        @item.BadgeText
                                    </div>
                                }

                                @* 🚨 Image/Background: ใช้ CoverImageUrl หรือ BackgroundGradient *@
                                <div class="news-image"
                                    style="background: @(string.IsNullOrEmpty(item.CoverImageUrl) ? item.BackgroundGradient : $"url(/{item.CoverImageUrl}) no-repeat center center / cover;");">

                                    @* ถ้าใช้ CoverImageUrl เราต้องใช้ Path ให้ถูกต้อง เช่น /images/news/cover/file.jpg *@
                                </div>

                                <div class="news-content">
                                    <div class="news-meta">
                                        @* 🚨 Date: แสดงวันที่ด้วยภาษาไทย *@
                                        <span class="news-date">📅 @item.lastupdate?.ToString("d MMM yyyy", new
                                                                            System.Globalization.CultureInfo("th-TH"))</span>

                            @* 🚨 Category: หมวดหมู่ข่าว *@
                            <span class="news-category">@item.Category</span>
                        </div>

                                    @* 🚨 Title *@
                                    <h3>@item.titlename</h3>

                                    @* 🚨 Details: ตัดข้อความให้สั้นลงเพื่อแสดงตัวอย่าง *@
                                    <p>
                            @{
                                            // ตัด HTML tags และจำกัดความยาว
                                            string cleanDetails = System.Text.RegularExpressions.Regex.Replace(item.details ?? "",
                                            "<.*?>", String.Empty);
                                            string summary = cleanDetails.Length > 120 ? cleanDetails.Substring(0, 120) + "..." :
                                            cleanDetails;
                                        }
                                        @summary
                                    </p>

                                    @* 🚨 Link: ลิงก์ไปยังหน้าแสดงรายละเอียดข่าว *@
                                    <a asp-controller="home" asp-action="Details" asp-route-id="@item.id" class="news-link">อ่านต่อ
                                        →</a>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="col-12 text-center py-5">
                            <p>⚠️ ยังไม่มีข่าวประชาสัมพันธ์ในขณะนี้</p>
                        </div>
                    }
                </div>

                <div style="text-align: center; margin-top: 3rem;">
                    <a asp-controller="Home" asp-action="frmnewsAll" class="view-all-btn">ดูข่าวทั้งหมด →</a>
                </div>
            </section>
            <!-- Features Section -->
            <section class="containerlayout">
                <div class="section-title">
                    <h2>🎯 ระบบการจัดการ</h2>
                    <p>ระบบครบวงจรสำหรับการจัดงานศิลปหัตถกรรมอย่างมีประสิทธิภาพ</p>
                </div>

                <div class="features">
                    <div class="feature-card">
                        <div class="feature-icon">📝</div>
                        <h3>ลงทะเบียนออนไลน์</h3>
                        <p>ระบบลงทะเบียนโรงเรียนและนักเรียนที่สะดวก รวดเร็ว พร้อมระบบตรวจสอบข้อมูล</p>
                        <a href="#" class="btn" id="btnlogin">ลงทะเบียนเลย</a>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">📅</div>
                        <h3>ตารางการแข่งขัน</h3>
                        <p>ดูตารางการแข่งขันแบบละเอียด พร้อมระบบแจ้งเตือนก่อนถึงเวลาแข่งขัน</p>
                        <a href="#" class="btn" id="btnContestSchedule">ดูตารางแข่งขัน</a>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">👨‍⚖️</div>
                        <h3>สมัครเป็นกรรมการ</h3>
                        <p>เปิดรับสมัครครูและผู้เชี่ยวชาญ พร้อมสิทธิประโยชน์และค่าตอบแทน</p>
                        <a href="#" class="btn" id="btndirector">สมัครกรรมการ</a>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">🏆</div>
                        <h3>ผลการแข่งขัน</h3>
                        <p>ตรวจสอบผลการแข่งขันแบบ Real-time พร้อมดาวน์โหลดเกียรติบัตรทันที</p>
                        <a href="#" class="btn">ดูผลการแข่งขัน</a>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">📊</div>
                        <h3>รายงานสถิติ</h3>
                        <p>สถิติการแข่งขัน คะแนน และผลงานแยกตามโรงเรียนและรายการ</p>
                        <a href="@Url.Action("Statistics", "Home")" class="btn">ดูสถิติ</a>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">📱</div>
                        <h3>แอปพลิเคชัน</h3>
                        <p>ดาวน์โหลดแอปพลิเคชันเพื่อติดตามข่าวสารและผลการแข่งขัน</p>
                        <a href="#" class="btn">ดาวน์โหลด</a>
                    </div>
                </div>
            </section>
            <section class="gallery reveal" id="gallery">
                <div class="container">
                    <div class="section-title">
                        <h2>ภาพบรรยากาศจากปีก่อนๆ</h2>
                        <p>สัมผัสความมุ่งมั่น ความคิดสร้างสรรค์ และความสำเร็จ</p>
                    </div>
                    <div class="row">
                        <div class="col-lg-4 col-md-6 gallery-item">
                            <a href="images/gallery/photo1.jpg" data-toggle="lightbox" data-gallery="gallery">
                                <img src="images/gallery/photo1.jpg" class="img-fluid" alt="ภาพการแข่งขัน">
                            </a>
                        </div>
                        <div class="col-lg-4 col-md-6 gallery-item">
                            <a href="images/gallery/photo2.jpg" data-toggle="lightbox" data-gallery="gallery">
                                <img src="images/gallery/photo2.jpg" class="img-fluid" alt="ผลงานนักเรียน">
                            </a>
                        </div>
                        <div class="col-lg-4 col-md-6 gallery-item">
                            <a href="https://www.youtube.com/watch?v=gKi1tpvn-9I" data-toggle="lightbox"
                                data-gallery="gallery">
                                <img src="images/gallery/video_thumbnail.jpg" class="img-fluid" alt="วิดีโอไฮไลท์">
                                <div class="play-button"><i class="fas fa-play"></i></div>
                            </a>
                        </div>
                    </div>
                </div>
            </section>
            <section class="results reveal" id="results">
                <div class="container text-center">
                    <div class="section-title">
                        <h2>🏆 ผลการแข่งขัน</h2>
                        <p>ตรวจสอบผลการแข่งขันทุกรายการได้ที่นี่</p>
                    </div>
                    <a asp-controller="Home" asp-action="frmresults" class="cta-button large">ดูผลการแข่งขันทั้งหมด</a>
                    <p class="mt-3">หรือค้นหาตามรายการแข่งขัน</p>
                    <form asp-controller="Results" asp-action="Search" class="search-form">
                        <input type="text" name="query" placeholder="พิมพ์ชื่อรายการแข่งขัน...">
                        <button type="submit"><i class="fas fa-search"></i></button>
                    </form>
                </div>
            </section>
        }
        <div class="container-fluid content-after-parallax force-clear-container no-top-space">
            <main role="main" class="pb-3">
                @RenderBody()
            </main>
        </div>
        @if (ViewBag.ShowParallax ?? false)
        {
            <!-- CTA Section -->
            <section class="cta-section">
                <h2>🎨 พร้อมแสดงศักยภาพของน้องๆ แล้วหรือยัง?</h2>
                <p>ลงทะเบียนวันนี้เพื่อเข้าร่วมงานศิลปหัตถกรรมนักเรียนครั้งที่ 73</p>
                <div class="cta-buttons">
                    <a href="#" class="cta-btn" id="RegistrationStatusButton">📝 ตรวจสอบสถานะการสมัคร</a>
                    <a href="#" class="cta-btn" id="contactButton">📞 ติดต่อสอบถาม</a>
                </div>
            </section>
            <section class="contact-line-section">
                <h2>ติดต่อเราได้ง่ายๆ ผ่าน LINE</h2>
                <p>เพียงสแกน QR Code หรือกดปุ่มเพิ่มเพื่อน</p>

                <div class="contact-desktop">
                    <img src="line/your-line-qr-code.png" alt="LINE QR Code">

                    <p><strong>LINE ID: @lineID</strong></p>
                </div>

                <div class="contact-mobile">
                    <a href="https://line.me/ti/p/~@@668ptodu" class="line-add-button" target="_blank">
                        <i class="fab fa-line"></i> เพิ่มเพื่อนใน LINE
                    </a>
                </div>
            </section>
        }
        <a href="https://line.me/ti/p/~@@668ptodu" class="line-fab" target="_blank">
            <i class="fab fa-line"></i>
        </a>
        <!-- Main Footer -->
        <footer class="main-footer">
            <!-- To the right -->
            <div class="float-right d-none d-sm-inline">
                ศิลปหัตถกรรมนักเรียน จังหวัดนครราชสีมา
            </div>
            <!-- Default to the left -->
            <strong>Copyright &copy; 2014-2025 <a
                    href="https://www.facebook.com/roonevo10/?locale=th_TH">Silapa</a>.</strong> All rights reserved.
            <div class="mt-2">
                @await Component.InvokeAsync("VisitorCounter")
            </div>
        </footer>
    </div>
    <div class="modal fade" id="pdfModal" tabindex="-1" role="dialog" aria-labelledby="pdfModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="pdfModalLabel">ประกาศ</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="height: 80vh;">
                    <iframe id="pdf-iframe" src="" style="width:100%; height:100%; border:none;"></iframe>
                </div>
            </div>
        </div>
    </div>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <!-- jQuery -->
    <script src="~/plugins/jquery/jquery.min.js"></script>
    <!-- Bootstrap 4 -->
    <script src="~/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- AdminLTE App -->
    <script src="~/dist/js/adminlte.min.js"></script>
    <!-- AdminLTE for demo purposes -->
    <script src="~/dist/js/demo.js"></script>
    <!-- DataTables  & Plugins -->
    <script src="~/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="~/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="~/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
    <script src="~/plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
    <script src="~/plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
    <script src="~/plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
    <script src="~/plugins/jszip/jszip.min.js"></script>
    <script src="~/plugins/pdfmake/pdfmake.min.js"></script>
    <script src="~/plugins/pdfmake/vfs_fonts.js"></script>
    <script src="~/plugins/datatables-buttons/js/buttons.html5.min.js"></script>
    <script src="~/plugins/datatables-buttons/js/buttons.print.min.js"></script>
    <script src="~/plugins/datatables-buttons/js/buttons.colVis.min.js"></script>
    <!-- Bootstrap 4 -->
    <script src="~/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- Select2 -->
    <script src="~/plugins/select2/js/select2.full.min.js"></script>
    <!-- Bootstrap4 Duallistbox -->
    <script src="~/plugins/bootstrap4-duallistbox/jquery.bootstrap-duallistbox.min.js"></script>
    <!-- InputMask -->
    <script src="~/plugins/moment/moment.min.js"></script>
    <script src="~/plugins/inputmask/jquery.inputmask.min.js"></script>
    <!-- date-range-picker -->
    <script src="~/plugins/daterangepicker/daterangepicker.js"></script>
    <!-- bootstrap color picker -->
    <script src="~/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js"></script>
    <!-- Tempusdominus Bootstrap 4 -->
    <script src="~/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>
    <!-- Bootstrap Switch -->
    <script src="~/plugins/bootstrap-switch/js/bootstrap-switch.min.js"></script>
    <!-- BS-Stepper -->
    <script src="~/plugins/bs-stepper/js/bs-stepper.min.js"></script>
    <!-- dropzonejs -->
    <script src="~/plugins/dropzone/min/dropzone.min.js"></script>
    <!-- Summernote -->
    <script src="~/plugins/summernote/summernote-bs4.min.js"></script>
    <!-- CodeMirror -->
    <script src="~/plugins/bs-custom-file-input/bs-custom-file-input.min.js"></script>
    <script src="~/plugins/codemirror/codemirror.js"></script>
    <script src="~/plugins/codemirror/mode/css/css.js"></script>
    <script src="~/plugins/codemirror/mode/xml/xml.js"></script>
    <script src="~/plugins/codemirror/mode/htmlmixed/htmlmixed.js"></script>
    <script src="~/plugins/chart.js/Chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        const deadline = new Date("@activeSystem.endgisterdate").getTime(); // ใช้ @activeSystem.endgisterdate จาก ViewBag

        const updateCountdown = setInterval(function () {
            const now = new Date().getTime();
            const distance = deadline - now;

            // คำนวณเวลา
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            // แสดงผล
            document.getElementById("days").innerHTML = days.toString().padStart(2, '0');
            document.getElementById("hours").innerHTML = hours.toString().padStart(2, '0');
            document.getElementById("minutes").innerHTML = minutes.toString().padStart(2, '0');
            document.getElementById("seconds").innerHTML = seconds.toString().padStart(2, '0');

            // ถ้าหมดเวลา
            if (distance < 0) {
                clearInterval(updateCountdown);
                document.getElementById("countdown").innerHTML = "ปิดรับสมัครแล้ว";
                // ซ่อน Urgency Banner (สามารถทำได้ด้วยการเพิ่ม Class)
                document.querySelector('.urgent-banner').style.display = 'none';
            }
        }, 1000);
        document.getElementById('criteriaButton').addEventListener('click', function (event) {
            event.preventDefault(); // ป้องกันการกระโดดไปยังด้านบนของหน้า (href="#")

            // นี่คือโค้ด JavaScript ที่จะทำการเปลี่ยนเส้นทางไปยัง Action ที่ต้องการ
            // โดยจำลองการทำงานเหมือนกับ Tag Helper ที่ถูกสร้างขึ้น
            window.location.href = '@Url.Action("frmcriterion", "Home")';
        });
        document.getElementById('FilelistButton').addEventListener('click', function (event) {
            event.preventDefault(); // ป้องกันการกระโดดไปยังด้านบนของหน้า (href="#")

            // นี่คือโค้ด JavaScript ที่จะทำการเปลี่ยนเส้นทางไปยัง Action ที่ต้องการ
            // โดยจำลองการทำงานเหมือนกับ Tag Helper ที่ถูกสร้างขึ้น
            window.location.href = '@Url.Action("frmfilelistAll", "Home")';
        });
        document.getElementById('ContestScheduleButton').addEventListener('click', function (event) {
            event.preventDefault(); // ป้องกันการกระโดดไปยังด้านบนของหน้า (href="#")

            // นี่คือโค้ด JavaScript ที่จะทำการเปลี่ยนเส้นทางไปยัง Action ที่ต้องการ
            // โดยจำลองการทำงานเหมือนกับ Tag Helper ที่ถูกสร้างขึ้น
            window.location.href = '@Url.Action("ContestSchedule", "Home")';
        });

        $('#newsAnchorButton').on('click', function (e) {
            e.preventDefault();
            $('html, body').animate({
                scrollTop: $('#news-section').offset().top
            }, 800); // 800 คือระยะเวลา (ms) ในการเลื่อน (ปรับให้ช้า/เร็วได้)
        });

        // รอให้หน้าเว็บโหลดเสร็จสมบูรณ์ก่อน ค่อยเริ่มทำงาน
        document.addEventListener('DOMContentLoaded', function () {

            // 1. ค้นหาปุ่มด้วย id ที่เราตั้งไว้
            const announcementBtn = document.getElementById('announcementButton');

            // 2. เพิ่ม "ตัวดักฟัง" เหตุการณ์คลิก
            if (announcementBtn) { // ตรวจสอบก่อนว่าหาปุ่มเจอจริง
                announcementBtn.addEventListener('click', function (event) {

                    // 3. ป้องกันไม่ให้ลิงก์ทำงานแบบปกติ (กระโดดไปที่ #)
                    event.preventDefault();

                    var dynamicFileName = @Json.Serialize(activeSystem?.DeclarationFilePath);
                    if (dynamicFileName) {
                        // 3. (JS) สร้าง URL ที่ถูกต้อง
                        // (ต้องแน่ใจว่า '~/card/' คือโฟลเดอร์ที่ถูกต้อง)
                        var pdfUrl = '@Url.Content("~/card/")' + dynamicFileName;

                        // 4. (JS) เปิด Modal (โค้ดเดิมของคุณ)
                        $('#pdf-iframe').attr('src', pdfUrl);
                        $('#pdfModal').modal('show');
                    }
                    else {
                        // 5. (JS) (แนะนำ) แจ้งเตือนถ้ายังไม่มีไฟล์
                        Swal.fire(
                            'ไม่พบไฟล์',
                            'ยังไม่มีการอัปโหลดไฟล์ประกาศในขณะนี้',
                            'info'
                        );
                    }
                });
            }
            //รายชื่อผู้ประสานงาน
            const contactBtn = document.getElementById('contactButton');
            if (contactBtn) { // ตรวจสอบก่อนว่าหาปุ่มเจอ
                contactBtn.addEventListener('click', function (event) {
                    // ป้องกันไม่ให้ลิงก์ # ทำงาน
                    event.preventDefault();

                    // สั่งให้เปลี่ยนหน้าไปยังที่ที่เราต้องการ
                    window.location.href = '@Url.Action("contacts", "Home")';
                });
            }
            //โรงเรียนที่ลงทะเบียน
            const RegistrationStatusBtn = document.getElementById('RegistrationStatusButton');
            if (RegistrationStatusBtn) { // ตรวจสอบก่อนว่าหาปุ่มเจอ
                RegistrationStatusBtn.addEventListener('click', function (event) {
                    // ป้องกันไม่ให้ลิงก์ # ทำงาน
                    event.preventDefault();

                    // สั่งให้เปลี่ยนหน้าไปยังที่ที่เราต้องการ
                    window.location.href = '@Url.Action("RegistrationStatus", "Home")';
                });
            }
            //โรงเรียนที่ลงทะเบียน

            const LoginBtn = document.getElementById('btnlogin');
            if (LoginBtn) { // ตรวจสอบก่อนว่าหาปุ่มเจอ
                LoginBtn.addEventListener('click', function (event) {
                    // ป้องกันไม่ให้ลิงก์ # ทำงาน
                    event.preventDefault();

                    // สั่งให้เปลี่ยนหน้าไปยังที่ที่เราต้องการ
                    window.location.href = '@Url.Action("Login", "Account")';
                });
            }
            const ContestScheduleBtn = document.getElementById('btnContestSchedule');
            if (ContestScheduleBtn) { // ตรวจสอบก่อนว่าหาปุ่มเจอ
                ContestScheduleBtn.addEventListener('click', function (event) {
                    // ป้องกันไม่ให้ลิงก์ # ทำงาน
                    event.preventDefault();

                    // สั่งให้เปลี่ยนหน้าไปยังที่ที่เราต้องการ
                    window.location.href = '@Url.Action("ContestSchedule", "Home")';
                });
            }
            FilelistButton
            const directorBtn = document.getElementById('btndirector');
            if (directorBtn) { // ตรวจสอบก่อนว่าหาปุ่มเจอ
                directorBtn.addEventListener('click', function (event) {
                    // ป้องกันไม่ให้ลิงก์ # ทำงาน
                    event.preventDefault();

                    // สั่งให้เปลี่ยนหน้าไปยังที่ที่เราต้องการ
                    window.location.href = '@Url.Action("frmregisterdirectorAll", "Home")';
                });
            }
            const heroResultsBtn = document.getElementById('HeroResultsButton');
            if (heroResultsBtn) {
                heroResultsBtn.addEventListener('click', function (event) {
                    event.preventDefault();
                    // เปลี่ยน Link ไปยัง Controller ที่ถูกต้อง
                    window.location.href = '@Url.Action("frmresults", "Home")';
                });
            }


        });
    </script>
    @await RenderSectionAsync("Scripts", required: false)

</body>


</html>